<html><head><title>SEQBLK</title></head>
<body bgcolor="#ffffff">
<a name="SEQBLK"><h3>SEQBLK</h3></a>
 
Purpose - 
<p>Flow of Execution
<ul>
<li><a href="#L1"></a>
</ul>
<p>Code Group 
   <a href="../HRINGEN.html">HRINGEN</a>
<p>Called By
   <a href="../HEXTUTIL/UCIGEN.html">UCIGEN</a>
<p>Common Blocks <i>none</i> 
<p>Calls
   <a href="../HIOUCI/DUMPER.html">DUMPER</a>,
   <a href="NEWEXG.html">NEWEXG</a>,
   <a href="NEWING.html">NEWING</a>,
   NEWOPN,
   OMSG,
   <a href="ENDEXG.html">ENDEXG</a>,
   CRINTE,
   ENDING,
   OMSTC,
   WMSGTT,
   <a href="../HIOUCI/GETUCI.html">GETUCI</a>,
   <a href="../HIOUCI/GETSE.html">GETSE</a>,
   GETEND,
   CHKSTR,
   PMXTFT,
   PMXTFC,
   HDMES2
<p>Code
<pre>
C
C
C
      SUBROUTINE   SEQBLK
     I                   (MESSU,MSGFL,NIVLS,IVLLIB,
     I                    OUTLEV,RUNMIN,MAXOPN,LKWOPR,NKWOPR,KWDOPR,
     M                    WCOUNT,ECOUNT,
     O                    EXGTAB,GRPTAB,OPNTAB,NXGRPS,NGRPS,
     O                    NOPNS)
C
C     + + + PURPOSE + + +
C     Read and process the opn sequence block
C
C     + + + DUMMY ARGUMENTS + + +
      INTEGER     ECOUNT,MSGFL,
     $            EXGTAB(5,10),GRPTAB(5,10),MAXOPN,LKWOPR,NKWOPR,
     $            IVLLIB(20),MESSU,NGRPS,NIVLS,NOPNS,
     $            NXGRPS,OPNTAB(20,MAXOPN),OUTLEV,RUNMIN,
     $            WCOUNT(10)
      CHARACTER*1 KWDOPR(LKWOPR,NKWOPR)
C
C     + + + ARGUMENT DEFINITIONS + + +
C     MESSU  - ftn unit no. to be used for printout of messages
C     MSGFL  - fortran unit number of HSPF message file
C     NIVLS  - ???
C     IVLLIB - ???
C     OUTLEV - run interpreter output level
C     RUNMIN - span of run in minutes
C     MAXOPN - maximum number of operations
C     LKWOPR - length of operation name keywords
C     NKWOPR - number of operation name keywords
C     KWDOPR - operation name keyword library
C     WCOUNT - ???
C     ECOUNT - count(s) of specific errors
C     EXGTAB - ???
C     GRPTAB - ???
C     OPNTAB - ???
C     NXGRPS - ???
C     NGRPS  - ???
C     NOPNS  - ???
C
C     + + + LOCAL VARIABLES + + +
      INTEGER      EXFG,GRPNO,HRMIN(2),I,I0,I1,ITYP,I20,
     $             ICOUNT,INFG,J,KEY,I12,KEYST,KEYND,
     $             KWDNO,MENTRY,NDELT,OPNO,OPTNO,
     $             XCOUNT,XDELT,XGRPNO,SCLU,SGRP,
     $             INITFG,CLEN,CONT,ITMP(1),ERRINT,IOPT
      CHARACTER*4  CEND
      CHARACTER*6  CBLNK6
      CHARACTER*8  CEXG,CING
      CHARACTER*20 CHSTR
      CHARACTER*80 UCIBF
C
C     + + + EQUIVALENCES + + +
      EQUIVALENCE (CHSTR,CHSTR1),(UCIBF,UCIBF1)
      CHARACTER*1  CHSTR1(20),UCIBF1(80)
C
C     + + + FUNCTIONS + + +
      INTEGER    CHKSTR,CRINTE
C
C     + + + EXTERNALS + + +
      EXTERNAL   DUMPER,NEWEXG,NEWING,NEWOPN,OMSG,ENDEXG,CRINTE
      EXTERNAL   ENDING,OMSTC,WMSGTT,GETUCI,GETSE,GETEND,CHKSTR
      EXTERNAL   PMXTFT,PMXTFC,HDMES2
C
C     + + + INPUT FORMATS + + +
 1000 FORMAT (A4,A2)
 1010 FORMAT (30X,I2,1X,I2)
C
C     + + + OUTPUT FORMATS + + +
 2050 FORMAT (/,' FOUND END EXGROUP')
 2070 FORMAT (/,' FOUND END INGROUP')
 2082 FORMAT (  ' GENERATED END INGROUP')
 2084 FORMAT (  ' GENERATED END EXGROUP')
 2090 FORMAT (/,' CONTENTS OF TABLES GENERATED BY SUBROUTINE SEQBLK',/)
 2100 FORMAT (/,' EXGROUP TABLE')
 2110 FORMAT (/,'    EXGROUP     FIRST      LAST      TIME')
 2120 FORMAT (  '        NO.   INGROUP   INGROUP  INTERVAL')
 2130 FORMAT (  '                                   (MINS)')
 2140 FORMAT (  ' ',4I10)
 2150 FORMAT (/,' INGROUP TABLE')
 2160 FORMAT (/,'    INGROUP     FIRST      LAST      TIME')
 2170 FORMAT (  '        NO. OPERATION OPERATION  INTERVAL')
 2180 FORMAT (/,' OPERATION TABLE')
 2190 FORMAT (/,'  OPERATION       OPN   OP-TYPE             EXGROUP',
     $        '   INGROUP')
 2200 FORMAT (' ','       NO.      TYPE       NO.    OMCODE       NO.',
     $        '       NO.',/)
 2210 FORMAT (' ',I10,4X,A4,A2,4I10)
 2220 FORMAT (/,' NO OPERATIONS PROCESSED')
 2230 FORMAT (/,' FINISHED PROCESSING OPN SEQUENCE BLOCK',
     $        /,' ',132('='))

C
C     + + + END SPECIFICATIONS + + +
C
      I0    = 0
      I1    = 1
      I12   = 12
      I20   = 20
      SCLU  = 211
      ERRINT= -999
      CBLNK6='      '
C
C     read opn specific keyword info from msg file
      SGRP  = 5
      INITFG= 1
      CLEN  = 16
      CALL WMSGTT (MSGFL,SCLU,SGRP,INITFG,
     M             CLEN,
     O             CHSTR1,CONT)
      CEXG = CHSTR(1:8)
      CING = CHSTR(9:16)
C
      CALL GETEND(CEND)
C
C     find table in uci (type 3 from hspf.seq, grp 22, col 3
      ITYP= 3
      CALL <a href="../HIOUCI/GETSE.html">GETSE</a>(ITYP,I1,
     O           KEYST,KEYND)
      KEY= KEYST
      IF (KEYST .GT. 0) THEN
        CALL <a href="../HIOUCI/GETUCI.html">GETUCI</a> (I0,
     M               KEY,
     O               UCIBF)
      END IF
      IF (KEY .NE. KEYND) THEN
C       opn sequence block has been supplied and is not empty
        IOPT= 2
        CALL HDMES2(IOPT,ITYP,I1)
        IF (OUTLEV.GT.0) THEN
C         processing message
          SGRP= 130
          CALL PMXTFT(MSGFL,MESSU,SCLU,SGRP)
          IF (OUTLEV.GT.2) THEN
C           dump user's control input
            CALL <a href="../HIOUCI/DUMPER.html">DUMPER</a> (KEYST,KEYND,MESSU)
          END IF
        END IF
C
C       initialize
        XGRPNO= 0
        GRPNO = 0
        OPNO  = 0
C
C       max no. of entries in tables
        MENTRY= MAXOPN
        EXFG  = 0
        INFG  = 0
C
C       zero tables
        DO 40 I= 1,10
          DO 30 J= 1,5
            EXGTAB(J,I)= 0
            GRPTAB(J,I)= 0
 30       CONTINUE
 40     CONTINUE
C
        DO 45 I= 1,MAXOPN
          READ(CBLNK6,1000) (OPNTAB(J,I),J=1,2)
          OPNTAB(3,I)= 0
          OPNTAB(4,I)= 0
          OPNTAB(5,I)= 0
          OPNTAB(6,I)= 0
 45     CONTINUE
C
C       whiledo key< keynd
 50     CONTINUE
          READ (UCIBF,1010,ERR=60)  HRMIN
            GO TO 70
 60       CONTINUE
C           error - cannot read time step of run
            I= 12
            CALL OMSTC (I,UCIBF1(24))
            SGRP= 126
            CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M                 ECOUNT)
            HRMIN(1)= 24
            HRMIN(2)= 0
 70       CONTINUE
C         see if we have a keyword - test each of 3 possible fields
          IF (UCIBF(1:8) .EQ. CEXG) THEN
C           exgroup
            IF (OUTLEV.GT.4) THEN
C             exgrp
              SGRP= 131
              CALL PMXTFT(MSGFL,MESSU,SCLU,SGRP)
            END IF
C           warning - external scratch pad is not implemented in
C           this release of hspf
            SGRP = 1
            CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M                 WCOUNT(1))
C           check and remember details for this exgroup
            CALL <a href="NEWEXG.html">NEWEXG</a> (EXFG,MESSU,MSGFL,SCLU,XGRPNO,
     $                   INFG,GRPNO,HRMIN,NIVLS,IVLLIB,
     $                   RUNMIN,
     M                   ECOUNT,
     O                   XCOUNT,XDELT)
            EXFG= 1
          ELSE IF (UCIBF(5:12) .EQ. CING) THEN
C           ingroup
            IF (OUTLEV.GT.4) THEN
C             ingrp
              SGRP= 132
              CALL PMXTFT(MSGFL,MESSU,SCLU,SGRP)
            END IF
            CALL <a href="NEWING.html">NEWING</a> (INFG,EXFG,MESSU,MSGFL,SCLU,
     $                   GRPNO,XGRPNO,OUTLEV,HRMIN,NIVLS,
     $                   IVLLIB,RUNMIN,
     M                   ECOUNT,
     O                   ICOUNT,NDELT,XCOUNT,XDELT)
            INFG=1
          ELSE
C           test third (operation) field
            CHSTR= UCIBF(7:12)
            KWDNO= CHKSTR (LKWOPR,NKWOPR,CHSTR1,KWDOPR)
            J= 5
            OPTNO = CRINTE(ERRINT,J,UCIBF1(16))
            IF ( (KWDNO.GT.0) .AND. (OPTNO .NE. ERRINT) ) THEN
C             operation
              IF (OUTLEV.GT.4) THEN
                ITMP(1)= 14
                SGRP   = 133
                CALL PMXTFC (MSGFL,MESSU,SCLU,SGRP,I1,ITMP,UCIBF1(7))
              END IF
              CALL NEWOPN (CHSTR,OPTNO,MESSU,MSGFL,SCLU,
     I                     INFG,EXFG,OUTLEV,HRMIN,
     I                     NIVLS,IVLLIB,RUNMIN,
     I                     KWDNO,MENTRY,MAXOPN,
     M                     OPNO,ECOUNT,GRPNO,XGRPNO,
     M                     ICOUNT,XCOUNT,NDELT,XDELT,WCOUNT,
     O                     OPNTAB,GRPTAB,EXGTAB)
            ELSE
C             no keyword was recognized - check whether we have a
C             delimiter
C             first (exgroup) field
              IF (UCIBF(1:4).EQ.CEND) THEN
C               found a delimiter
                IF (UCIBF(5:12) .EQ. CEXG) THEN
C                 end exgroup
                  IF (OUTLEV.GT.4) THEN
                    WRITE (MESSU,2050)
                  END IF
                  IF (EXFG.EQ.0) THEN
C                   error - end exgroup found but corresponding
C                   valid exgroup heading didn't precede it -
C                   command ignored
                    SGRP = 21
                    CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M                         ECOUNT)
                  ELSE
                    CALL ENDEXG (INFG,XCOUNT,XGRPNO,GRPNO,
     I                           XDELT,MESSU,MSGFL,SCLU,
     M                           ECOUNT,WCOUNT,EXGTAB,
     O                           EXFG)
                  END IF
                ELSE
C                 error - delimiter is invalid - ignored
                  CHSTR= UCIBF(1:12)
                  CALL OMSTC (I12,CHSTR1)
                  SGRP = 22
                  CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M                       ECOUNT)
                END IF
              ELSE IF (UCIBF(5:8).EQ.CEND) THEN
C               check second (ingroup) field
                IF (UCIBF(9:16).EQ.CING) THEN
C                 end ingroup
                  IF (OUTLEV.GT.4) THEN
                    WRITE (MESSU,2070)
                  END IF
                  CALL ENDING (INFG,EXFG,ICOUNT,XCOUNT,GRPNO,XGRPNO,
     I                         OPNO,NDELT,XDELT,MESSU,MSGFL,SCLU,OUTLEV,
     M                         ECOUNT,WCOUNT,
     O                         GRPTAB,EXGTAB)
                ELSE
C                 error - delimiter is invalid - ignored
                  CHSTR= UCIBF(1:12)
                  CALL OMSTC (I12,CHSTR1)
                  SGRP = 22
                  CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M                       ECOUNT)
                END IF
              ELSE
C               error - text not recognized as valid
C               heading or delimiter - ignored
                CHSTR= UCIBF(1:20)
                CALL OMSTC (I20,CHSTR1)
                SGRP = 23
                CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M                     ECOUNT)
              END IF
            END IF
          END IF
C         get the next record
          CALL <a href="../HIOUCI/GETUCI.html">GETUCI</a> (I0,
     M                 KEY,
     O                 UCIBF)
        IF (KEY .NE. KEYND) GO TO 50
C       end whiledo
C
        IF (INFG.NE.0) THEN
          IF (OUTLEV.GT.4) THEN
            WRITE (MESSU,2082)
          END IF
          CALL ENDING (INFG,EXFG,ICOUNT,XCOUNT,GRPNO,XGRPNO,OPNO,NDELT,
     I                 XDELT,MESSU,MSGFL,SCLU,OUTLEV,
     M                 ECOUNT,WCOUNT,
     O                 GRPTAB,EXGTAB)
        END IF
        IF (EXFG.NE.0) THEN
          IF (OUTLEV.GT.4) THEN
            WRITE (MESSU,2084)
          END IF
          CALL ENDEXG (INFG,XCOUNT,XGRPNO,GRPNO,XDELT,MESSU,MSGFL,SCLU,
     M                 ECOUNT,WCOUNT,EXGTAB,
     O                 EXFG)
        END IF
        NXGRPS= XGRPNO
        NGRPS = GRPNO
        NOPNS = OPNO
C
        IF (OUTLEV .GT. 3) THEN
C         dump the tables
          IF (NOPNS .GT. 0) THEN
            WRITE (MESSU,2090)
C           exgroup table
            WRITE (MESSU,2100)
            WRITE (MESSU,2110)
            WRITE (MESSU,2120)
            WRITE (MESSU,2130)
            DO 240 I= 1,NXGRPS
              WRITE (MESSU,2140)  I, (EXGTAB(J,I),J=1,3)
 240        CONTINUE
C
C           ingroup table
            WRITE (MESSU,2150)
            WRITE (MESSU,2160)
            WRITE (MESSU,2170)
            WRITE (MESSU,2130)
            DO 250 I= 1,NGRPS
              WRITE (MESSU,2140)  I, (GRPTAB(J,I),J=1,3)
 250        CONTINUE
C
C           operation table
            WRITE (MESSU,2180)
            WRITE (MESSU,2190)
            WRITE (MESSU,2200)
            DO 260 I= 1,NOPNS
              WRITE (MESSU,2210)  I, (OPNTAB(J,I),J=1,6)
 260        CONTINUE
          ELSE
C           no operations processed
            WRITE (MESSU,2220)
          END IF
        END IF
C
        IF (OUTLEV.GT.0)  THEN
          WRITE (MESSU,2230)
        END IF
      ELSE
C       no operation sequence block was in user's control input
C       error - because "resume" mode is not supported in this
C       release of hspf
        SGRP = 24
        CALL OMSG (MESSU,MSGFL,SCLU,SGRP,
     M             ECOUNT)
      END IF
C
      RETURN
      END
</pre>










<Object type="application/x-oleobject" classid="clsid:1e2a7bd0-dab9-11d0-b93a-00c04fc99f9e">
    <param name="Keyword" value="SEQBLK">
</Object>

</body>
</html>

